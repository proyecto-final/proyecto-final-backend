services:
  mysql:
    profiles: [ "all", "mysql" ]
    build: ./mysql
    platform: linux
    ports:
      - "3306:3306"

  mongo:
    profiles: [ "all", "mongo" ]
    build: ./mongo
    platform: linux
    ports:
      - "27017:27017"

  usuarios:
    profiles: [ "all", "usuarios" ]
    platform: linux
    build:
      context: ./usuarios
      args:
        - MYSQL_CONNECTION_STRING=mysql://root:root@mysql:3306/test
        - ENVIRONMENT=DEV
    ports:
      - "3030:3030"
    depends_on:
      - mysql

  ips:
    profiles: [ "all", "ips" ]
    platform: linux
    build:
      context: ./ips
      args:
        - MONGODB_URI=mongodb://sherlock:root@mongo:27017
    ports:
      - "3031:3031"
    depends_on:
      - mongo

  correlacion:
    profiles: [ "all", "correlacion" ]
    platform: linux
    build:
      context: ./correlacion
      args:
        - MONGODB_URI=mongodb://sherlock:root@mongo:27017
    ports:
      - "3032:3032"
    depends_on:
      - mongo

  busqueda:
    profiles: [ "all", "busqueda" ]
    platform: linux
    build:
      context: ./busqueda
      args:
        - MONGODB_URI=mongodb://sherlock:root@mongo:27017
    ports:
      - "3033:3033"
    depends_on:
      - mongo

  timeline:
    profiles: [ "all", "timeline" ]
    platform: linux
    build:
      context: ./timeline
      args:
        - MONGODB_URI=mongodb://sherlock:root@mongo:27017
    ports:
      - "3034:3034"
    depends_on:
      - mongo
  evtx-converter:
    profiles: [ "all", "evtx-converter" ]
    build:
      context: ./evtx-converter
      args:
        - CORRELATION_URI=http://correlacion:3032/api
        - PLATFORM=linux
    ports:
      - "3036:3036"
  fake-gateway:
    profiles: [ "all", "gateway" ]
    platform: linux
    build: ./fake-gateway
    ports:
      - "3035:3035"
    depends_on:
      - mongo
      - usuarios
      - ips
      - correlacion
      - busqueda
      - timeline
